<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Elev8r – Goal Timeline</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 p-4">
  <div class="max-w-5xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-2xl mb-4">Goal Timeline</h1>

    <!-- Add goal -->
    <div class="grid grid-cols-5 gap-2 mb-4 items-end text-sm">
      <div>
        <label class="block">Year-Month</label>
        <input type="month" id="ym" class="w-full border px-1 rounded">
      </div>
      <div>
        <label class="block">Goal</label>
        <input id="goalName" placeholder="e.g. Car" class="w-full border px-1 rounded">
      </div>
      <div>
        <label class="block">Target ₹</label>
        <input id="target" type="number" class="w-full border px-1 rounded">
      </div>
      <div>
        <label class="block">Priority</label>
        <select id="priority" class="w-full border px-1 rounded">
          <option value="high">High</option>
          <option value="medium">Medium</option>
          <option value="low">Low</option>
        </select>
      </div>
      <button onclick="addRow()" class="bg-blue-600 text-white px-2 py-1 rounded">Add</button>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="bg-gray-100">
            <th>Year-Month</th><th>Goal</th><th>Target ₹</th>
            <th>Savings Begin</th><th>Estimated Complete</th><th>Remarks</th><th></th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <button onclick="location.href='sheet.html'" class="mt-6 bg-gray-600 text-white px-4 py-2 rounded">← Back to Sheet</button>
  </div>

  <script>
  const user  = JSON.parse(localStorage.getItem('elev8r_user') || '{}');
  const needs = JSON.parse(localStorage.getItem('elev8r_user') || '{}').needs || {};
  const wants = JSON.parse(localStorage.getItem('elev8r_user') || '{}').wantsHeads || {};

  // compute monthly surplus
  function surplus() {
    const inc = user.income || 0;
    const nTotal = Object.values(needs).reduce((a,b)=>a+(+b),0);
    const wTotal = Object.values(wants).reduce((a,b)=>a+(+b.value),0);
    return Math.max(0, inc - nTotal - wTotal);
  }

  let goals = JSON.parse(localStorage.getItem('elev8r_goals2') || '[]');

  function addRow() {
    const ym      = document.getElementById('ym').value;
    const name    = document.getElementById('goalName').value;
    const target  = Number(document.getElementById('target').value);
    const priority= document.getElementById('priority').value;
    if (!ym || !name || !target) return alert('Fill all fields');

    const begin   = new Date().toISOString().slice(0,7); // YYYY-MM
    const surplusAmt = surplus();
    let monthsNeeded = Math.ceil(target / surplusAmt) || 9999;
    if (priority === 'high' && monthsNeeded > 48) monthsNeeded = 48; // thumb rule cap
    const endDate = new Date(begin + '-01');
    endDate.setMonth(endDate.getMonth() + monthsNeeded);
    const complete = endDate.toISOString().slice(0,7);

    let remark = '';
    if (surplusAmt === 0) remark = 'Need surplus first';
    else if (monthsNeeded > 60) remark = 'Long term; raise surplus';
    else remark = 'On track';

    goals.push({ym, name, target, begin, complete, remark});
    localStorage.setItem('elev8r_goals2', JSON.stringify(goals));
    render();
    document.getElementById('ym').value=''; document.getElementById('goalName').value=''; document.getElementById('target').value='';
  }

  function delRow(i) {
    goals.splice(i,1);
    localStorage.setItem('elev8r_goals2', JSON.stringify(goals));
    render();
  }

  function render() {
    const tbody = document.getElementById('tbody');
    tbody.innerHTML = '';
    goals.forEach((g,i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${g.ym}</td>
        <td>${g.name}</td>
        <td>${g.target.toLocaleString()}</td>
        <td>${g.begin}</td>
        <td>${g.complete}</td>
        <td class="text-xs">${g.remark}</td>
        <td><button onclick="delRow(${i})" class="text-red-600">✕</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  render();
  </script>
</body>
</html>