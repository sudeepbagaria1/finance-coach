<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Elev8r – Budget Sheet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body class="bg-slate-100 p-4">
  <div class="max-w-5xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-2xl mb-4">My Budget Sheet vs Indian Averages</h1>

    <div x-data="sheet()" x-init="load()">
      <!-- Needs section -->
      <h2 class="text-lg font-bold mb-2">Needs (50 %)</h2>
      <div class="grid grid-cols-7 gap-2 mb-1 font-semibold">
        <div>Category</div><div>Your ₹</div><div>India % Range</div><div>India Min ₹</div><div>India Max ₹</div><div>Status</div>
      </div>
      <template x-for="(row, key) in needs" :key="key">
        <div class="grid grid-cols-7 gap-2 mb-1 items-center">
          <div x-text="row.label"></div>
          <input type="number" x-model.number="row.value" @input="recalc()"
                 class="w-full border px-1 rounded text-sm">
          <div x-text="row.pctMin + '-' + row.pctMax + '%'"></div>
          <div x-text="row.minRs.toLocaleString()"></div>
          <div x-text="row.maxRs.toLocaleString()"></div>
          <span :class="row.statusClass" x-text="row.status"></span>
        </div>
      </template>

      <!-- Savings section -->
      <h2 class="text-lg font-bold mt-6 mb-2">Savings (20 %)</h2>
      <div class="grid grid-cols-3 gap-2 mb-1 font-semibold">
        <div>Category</div><div>Your ₹</div><div>Goal % within 20 %</div>
      </div>
      <template x-for="(row, key) in savingsHeads" :key="key">
        <div class="grid grid-cols-3 gap-2 mb-1">
          <div x-text="row.label"></div>
          <input type="number" x-model.number="row.value" @input="recalc()"
                 class="w-full border px-1 rounded text-sm">
          <input type="number" x-model.number="row.goalPct" class="w-full border px-1 rounded text-sm" placeholder="%">
        </div>
      </template>

      <!-- Wants section -->
      <h2 class="text-lg font-bold mt-6 mb-2">Wants (30 %)</h2>
      <div class="grid grid-cols-3 gap-2 mb-1 font-semibold">
        <div>Category</div><div>Your ₹</div><div>Goal % within 30 %</div>
      </div>
      <template x-for="(row, key) in wantsHeads" :key="key">
        <div class="grid grid-cols-3 gap-2 mb-1">
          <div x-text="row.label"></div>
          <input type="number" x-model.number="row.value" @input="recalc()"
                 class="w-full border px-1 rounded text-sm">
          <input type="number" x-model.number="row.goalPct" class="w-full border px-1 rounded text-sm" placeholder="%">
        </div>
      </template>

      <!-- Totals -->
      <div class="grid grid-cols-7 gap-2 mt-4 font-bold">
        <div>Total Needs (50 %)</div>
        <div>₹ <span x-text="needsTotal.toLocaleString()"></span></div>
        <div>50 %</div>
        <div>₹ <span x-text="needsMin.toLocaleString()"></span></div>
        <div>₹ <span x-text="needsMax.toLocaleString()"></span></div>
        <div></div>
      </div>
      <div class="grid grid-cols-3 gap-2">
        <div>Total Savings (20 %)</div><div>₹ <span x-text="savingsTotal.toLocaleString()"></span></div><div></div>
      </div>
      <div class="grid grid-cols-3 gap-2">
        <div>Total Wants (30 %)</div><div>₹ <span x-text="wantsTotal.toLocaleString()"></span></div><div></div>
      </div>

      <button @click="save()" class="mt-6 bg-green-600 text-white px-4 py-2 rounded">Save</button>
      <button @click="location.href='goal-board.html'" class="ml-2 bg-blue-600 text-white px-4 py-2 rounded">Goals →</button>
    </div>
  </div>

  <script>
function sheet() {
  return {
    income: 0,
    needsMin: 0, needsMax: 0, needsTotal: 0,
    savingsTotal: 0, wantsTotal: 0,
    needs: {
      kitchen:   {label:'Kitchen',   value:0, pctMin:30, pctMax:35},
      school:    {label:'School',    value:0, pctMin:5,  pctMax:10},
      medicine:  {label:'Medicine',  value:0, pctMin:5,  pctMax:8},
      rent:      {label:'Rent/EMI',  value:0, pctMin:20, pctMax:25},
      transport: {label:'Transport', value:0, pctMin:8,  pctMax:12},
      others:    {label:'Others',    value:0, pctMin:10, pctMax:20}
    },
    savingsHeads: {
      emergency: {label:'Emergency Fund', value:0, goalPct:50},
      equity:    {label:'Equity/SIP',     value:0, goalPct:30},
      ppf:       {label:'PPF/Bonds',      value:0, goalPct:20}
    },
    wantsHeads: {
      car:       {label:'Car running', value:0, goalPct:40},
      vacation:  {label:'Vacation',    value:0, goalPct:20},
      shopping:  {label:'Shopping',    value:0, goalPct:20},
      utilities: {label:'Utilities',   value:0, goalPct:20}
    },
    incomeObj: {},

    getSuggestedSavingsSplit() {
      const age  = +this.incomeObj.age  || 30;
      const risk = +this.incomeObj.riskScore || 3;

      let equityPct = 0;
      switch (risk) {
        case 1: equityPct = Math.max(100 - age, 20); break;
        case 2:
        case 3: equityPct = Math.max(110 - age, 30); break;
        case 4:
        case 5: equityPct = Math.max(120 - age, 40); break;
      }

      const debtPct = 100 - equityPct;
      const ppfPct  = Math.round(debtPct * 0.7);
      const emergencyPct = 100 - equityPct - ppfPct;

      return {
        emergency: Math.max(10, emergencyPct),
        equity:    Math.round(equityPct),
        ppf:       Math.max(0, ppfPct)
      };
    },

    load() {
      const user = JSON.parse(localStorage.getItem('elev8r_user') || '{}');
      this.incomeObj = user;
      this.income = +user.income || 0;

      // restore Needs
      for (const k in this.needs) {
        this.needs[k].value = user.needs?.[k] || 0;
      }

      // restore Savings & Wants
      for (const k in this.savingsHeads) {
        const saved = user.savingsHeads?.[k];
        if (saved) {
          this.savingsHeads[k].value   = saved.value || 0;
          this.savingsHeads[k].goalPct = saved.goalPct || 33;
        } else {
          const split = this.getSuggestedSavingsSplit();
          this.savingsHeads[k].goalPct = split[k] || 33;
        }
      }
      for (const k in this.wantsHeads) {
        const saved = user.wantsHeads?.[k];
        if (saved) {
          this.wantsHeads[k].value   = saved.value || 0;
          this.wantsHeads[k].goalPct = saved.goalPct || 25;
        } else {
          this.wantsHeads[k].goalPct = {car:40,vacation:20,shopping:20,utilities:20}[k] || 25;
        }
      }

      this.recalc();
    },

    recalc() {
      const inc = this.income;
      this.needsMin   = Math.round(inc * 0.50);
      this.needsMax   = Math.round(inc * 0.50);
      this.needsTotal = Object.values(this.needs).reduce((s, r) => s + r.value, 0);

      for (const key in this.needs) {
        const row = this.needs[key];
        row.minRs = Math.round(inc * (row.pctMin / 100));
        row.maxRs = Math.round(inc * (row.pctMax / 100));
        if (row.value < row.minRs) { row.status = 'Below'; row.statusClass = 'text-red-600'; }
        else if (row.value > row.maxRs) { row.status = 'Above'; row.statusClass = 'text-orange-600'; }
        else { row.status = 'OK'; row.statusClass = 'text-green-600'; }
      }

      this.savingsTotal = Object.values(this.savingsHeads).reduce((s, r) => s + r.value, 0);
      this.wantsTotal   = Object.values(this.wantsHeads).reduce((s, r) => s + r.value, 0);
    },

    save() {
      const data = JSON.parse(localStorage.getItem('elev8r_user') || {});
      data.needs        = Object.fromEntries(Object.entries(this.needs).map(([k,v]) => [k,v.value]));
      data.savingsHeads = Object.fromEntries(Object.entries(this.savingsHeads).map(([k,v]) => [k,{value:v.value, goalPct:v.goalPct}]));
      data.wantsHeads   = Object.fromEntries(Object.entries(this.wantsHeads).map(([k,v]) => [k,{value:v.value, goalPct:v.goalPct}]));
      localStorage.setItem('elev8r_user', JSON.stringify(data));
      alert('Saved!');
    }
  };
}
</script>
  // keep the full user object so we can read age & riskScore
  incomeObj: {},

  getSuggestedSavingsSplit() {
    const age  = +this.incomeObj.age  || 30;
    const risk = +this.incomeObj.riskScore || 3;

    let equityPct = 0;
    switch (risk) {
      case 1: equityPct = Math.max(100 - age, 20); break;
      case 2:
      case 3: equityPct = Math.max(110 - age, 30); break;
      case 4:
      case 5: equityPct = Math.max(120 - age, 40); break;
    }

    const debtPct = 100 - equityPct;
    const ppfPct  = Math.round(debtPct * 0.7);
    const emergencyPct = 100 - equityPct - ppfPct;

    return {
      emergency: Math.max(10, emergencyPct),
      equity:    Math.round(equityPct),
      ppf:       Math.max(0, ppfPct)
    };
  },

  load() {
    const user = JSON.parse(localStorage.getItem('elev8r_user') || '{}');
    this.incomeObj = user;
    this.income = +user.income || 0;

    // restore Needs
    for (const k in this.needs) {
      this.needs[k].value = user.needs?.[k] || 0;
    }

    // restore Savings & Wants (objects with .value and .goalPct)
    for (const k in this.savingsHeads) {
      const saved = user.savingsHeads?.[k];
      if (saved) {
        this.savingsHeads[k].value   = saved.value || 0;
        this.savingsHeads[k].goalPct = saved.goalPct || 33;
      } else {
        // first load – apply dynamic rule
        const split = this.getSuggestedSavingsSplit();
        this.savingsHeads[k].goalPct = split[k] || 33;
      }
    }
    for (const k in this.wantsHeads) {
      const saved = user.wantsHeads?.[k];
      if (saved) {
        this.wantsHeads[k].value   = saved.value || 0;
        this.wantsHeads[k].goalPct = saved.goalPct || 25;
      } else {
        this.wantsHeads[k].goalPct = {car:40,vacation:20,shopping:20,utilities:20}[k] || 25;
      }
    }

    this.recalc();
  },

  recalc() {
    const inc = this.income;
    this.needsMin   = Math.round(inc * 0.50);
    this.needsMax   = Math.round(inc * 0.50);
    this.needsTotal = Object.values(this.needs).reduce((s, r) => s + r.value, 0);

    for (const key in this.needs) {
      const row = this.needs[key];
      row.minRs = Math.round(inc * (row.pctMin / 100));
      row.maxRs = Math.round(inc * (row.pctMax / 100));
      if (row.value < row.minRs) { row.status = 'Below'; row.statusClass = 'text-red-600'; }
      else if (row.value > row.maxRs) { row.status = 'Above'; row.statusClass = 'text-orange-600'; }
      else { row.status = 'OK'; row.statusClass = 'text-green-600'; }
    }

    this.savingsTotal = Object.values(this.savingsHeads).reduce((s, r) => s + r.value, 0);
    this.wantsTotal   = Object.values(this.wantsHeads).reduce((s, r) => s + r.value, 0);
  },

  save() {
    const data = JSON.parse(localStorage.getItem('elev8r_user') || {});
    data.needs       = Object.fromEntries(Object.entries(this.needs).map(([k,v])=>[k,v.value]));
    data.savingsHeads = Object.fromEntries(Object.entries(this.savingsHeads).map(([k,v])=>[k,{value:v.value, goalPct:v.goalPct}]));
    data.wantsHeads   = Object.fromEntries(Object.entries(this.wantsHeads).map(([k,v])=>[k,{value:v.value, goalPct:v.goalPct}]));
    localStorage.setItem('elev8r_user', JSON.stringify(data));
    alert('Saved!');
  }
};
      load() {
        const user = JSON.parse(localStorage.getItem('elev8r_user') || '{}');
        this.income = +user.income || 0;
        this.recalc();
      },
      recalc() {
        const inc = this.income;
        this.needsMin   = Math.round(inc * 0.50);
        this.needsMax   = Math.round(inc * 0.50);
        this.needsTotal = Object.values(this.needs).reduce((s, r) => s + r.value, 0);

        // populate min/max Rs and status colour
        for (const key in this.needs) {
          const row = this.needs[key];
          row.minRs = Math.round(inc * (row.pctMin / 100));
          row.maxRs = Math.round(inc * (row.pctMax / 100));
          if (row.value < row.minRs) { row.status = 'Below'; row.statusClass = 'text-red-600'; }
          else if (row.value > row.maxRs) { row.status = 'Above'; row.statusClass = 'text-orange-600'; }
          else { row.status = 'OK'; row.statusClass = 'text-green-600'; }
        }

        this.savingsTotal = Object.values(this.savingsHeads).reduce((s, r) => s + r.value, 0);
        this.wantsTotal   = Object.values(this.wantsHeads).reduce((s, r) => s + r.value, 0);
      },
      save() {
        const data = JSON.parse(localStorage.getItem('elev8r_user') || {});
        data.needs       = Object.fromEntries(Object.entries(this.needs).map(([k,v])=>[k,v.value]));
        data.savingsHeads = Object.fromEntries(Object.entries(this.savingsHeads).map(([k,v])=>[k,{value:v.value, goalPct:v.goalPct}]));
        data.wantsHeads   = Object.fromEntries(Object.entries(this.wantsHeads).map(([k,v])=>[k,{value:v.value, goalPct:v.goalPct}]));
        localStorage.setItem('elev8r_user', JSON.stringify(data));
        alert('Saved!');
      }
    };
  }
  </script>
</body>
</html>